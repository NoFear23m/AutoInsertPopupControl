<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:AutoInsertPopup">
    
    
    <Style TargetType="{x:Type local:AutoInsertPopupControl}">
        <Style.Resources>
            <DataTemplate x:Key="DefaultListItemTemplate">
                <ContentControl DataContext="{TemplateBinding Content}">
                    <TextBlock Text="{Binding ViewContent}"/>
                </ContentControl>

            </DataTemplate>
        </Style.Resources>
        <Setter Property="ListItemTemplate" Value="{DynamicResource DefaultListItemTemplate}"/>
        <!--<Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=PART_ListBox}"/>-->
        <Setter Property="Focusable" Value="False"/>
        
        <Setter Property="IsHitTestVisible" Value="False"/>
        <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
        <Setter Property="FocusManager.IsFocusScope" Value="True"/>
        <Setter Property="Template">
            <Setter.Value>
               
                <ControlTemplate TargetType="{x:Type local:AutoInsertPopupControl}">
                    <!--<ControlTemplate.Resources>
                        <DataTemplate x:Key="DefaultListItemTemplate">
                            <ContentControl DataContext="{TemplateBinding Content}">
                                <TextBlock Background="Green" Text="{Binding ViewContent}"/>    
                            </ContentControl>
                            
                        </DataTemplate>
                    </ControlTemplate.Resources>-->


                        <Popup x:Name="PART_Popup" PlacementTarget="{TemplateBinding TargetControl}" IsOpen="{TemplateBinding IsPopUpOpen}" Placement="{TemplateBinding Placement}"
                               HorizontalOffset="{TemplateBinding HorizontalOffset}" VerticalOffset="{TemplateBinding VerticalOffset}" Focusable="True" PlacementRectangle="{TemplateBinding PlacementRectangle}"
                               PopupAnimation="{TemplateBinding Popupanimation}">
                        <StackPanel Background="{TemplateBinding Background}">
                            <ListBox x:Name="PART_ListBox" ItemsSource="{TemplateBinding VisibleItems}" 
                                         ItemTemplate="{TemplateBinding ListItemTemplate}" Background="{TemplateBinding Background}"
                                         
                                         IsSynchronizedWithCurrentItem="True">
                                <ListBox.Style>
                                    <Style TargetType="ListBox">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type local:AutoInsertPopupControl}}, Path=VisibleItems.Count}"
                                                         Value="0">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ListBox.Style>
                                <ListBox.InputBindings>
                                    <KeyBinding Key="Enter" 
                                                    Command="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type local:AutoInsertPopupControl}}, Path=SeletItemCommand}"
                                                    CommandParameter="{Binding ElementName=PART_ListBox, Path=SelectedItem}"/>
                                </ListBox.InputBindings>
                            </ListBox>
                            <TextBlock Text="Keine Ergebnisse gefunden" Background="{TemplateBinding Background}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type local:AutoInsertPopupControl}}, Path=VisibleItems.Count}"
                                                         Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                        
                         

                           



                        </Popup>
                       
                </ControlTemplate>

                
            </Setter.Value>
        </Setter>
    </Style>
    
</ResourceDictionary>
